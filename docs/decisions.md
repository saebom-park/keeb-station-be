# Architecture Decisions Log

## 목적
keeb-station 프로젝트에서 내려진 중요한 설계/기술 결정을 기록한다.

---

## 2025-12-26
### 주문 테이블명 `orders` 사용
- 결정: 테이블명을 `order`가 아닌 `orders`로 사용
- 이유:
  - SQL 예약어 회피
  - 쿼리 가독성 향상
  - 실무 관례

---

## 2025-12-26
### 금액 컬럼 BIGINT 사용
- 결정: 모든 금액 관련 컬럼을 BIGINT로 통일
- 이유:
  - 금액 정확성
  - 확장성
  - 실무 기준 부합

---

## 2025-12-26
### ProductOption을 실제 판매 단위로 채택
- 결정: 장바구니/주문은 ProductOption 기준
- 이유:
  - 옵션별 재고 관리
  - 주문 이력 정확성

---

## 2025-12-30
### 재고 동시성 제어에 낙관적 락(@Version) 적용
- 결정: Stock 엔티티에 @Version 필드 적용
- 이유:
  - 재고 충돌은 빈번하지 않음
  - 비관적 락 대비 성능/확장성 유리
  - 테스트 코드로 동시 주문 충돌 검증

---

## 2025-12-30
### Enum 컬럼을 ORDINAL 대신 VARCHAR로 저장
- 결정: 모든 Enum 컬럼을 VARCHAR로 매핑
- 이유:
  - Enum 순서 변경 시 데이터 깨짐 방지
  - 운영/쿼리 가독성

---

## 2026-01-02
### 주문 결제를 Payment 도메인으로 분리
- 결정: 주문 결제 로직을 OrderService에서 제거하고 PaymentService로 이관
- 이유:
  - 결제는 주문 상태 변경 이상의 책임을 가짐
  - 중복 결제, 금액 검증, 외부 PG 연동 대비
  - 도메인 책임 분리 및 확장성 확보

---

## 2026-01-02
### 결제 API를 payments 리소스로 설계
- 결정: `/api/orders/{orderId}/payments` 경로 사용
- 이유:
  - Payment는 Order에 종속된 리소스
  - REST 관점에서 리소스 생성 의미가 명확
  - 결제 이력/조회 API 확장에 유리

---

## 2025-01-02
### 결제 금액 검증을 PaymentService에서 수행
- 결정: 결제 금액과 주문 총액 일치 여부를 PaymentService에서 검증
- 이유:
  - 결제 도메인의 핵심 불변 조건
  - 테스트로 규칙 고정
